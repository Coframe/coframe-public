var Coframejs;(()=>{"use strict";var e={d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};function replaceHTMLContent(e,n,t){if(containsHTML(e)||containsHTML(n))setTimeout((()=>{const o=document.createElement("div");o.innerHTML=e;const a=document.createElement("div");a.innerHTML=n;const r=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,null,!1);let i;for(;(i=r.nextNode())&&i.innerHTML.includes(e););!function replaceNodeContent(e,n,t,o){const a=document.createDocumentFragment();for(const r of Array.from(e.childNodes))if(r.nodeType===Node.ELEMENT_NODE&&r.outerHTML.includes(n.innerHTML)){r.setAttribute("coframe-id",o);const e=r.outerHTML.replace(n.innerHTML,t.innerHTML),i=document.createElement("div");i.innerHTML=e,a.appendChild(i.firstChild)}else a.appendChild(r);e.textContent="",e.appendChild(a)}(i.parentElement,o,a,t)}),0);else{const o=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,!1),a=new RegExp(e,"g");let r;for(;r=o.nextNode();)r.parentElement&&"script"!==r.parentElement.tagName.toLowerCase()&&r.textContent.search(a)>=0&&(r.textContent=r.textContent.replace(a,n),r.parentElement.setAttribute("coframe-id",t))}}function containsHTML(e){return/<[a-z][\s\S]*>/i.test(e)}e.r(n),e.d(n,{getVariants:()=>getVariants,measureBounce:()=>measureBounce,measureConversion:()=>measureConversion,measureEngagement:()=>measureEngagement,sendDataToBackend:()=>sendDataToBackend});const t=1e4;let o=null,a=!1,r=!1,i=!0,s=[],c=[];async function getVariants(e,n,t,o){return(await fetch("https://coframe.ai/api/v1/retrieve_variants_page/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({coframe_page_id:e,time:n,languages:void 0!==t?t.languages||t.language:void 0,platform:void 0!==t?t.platform||t.userAgentData&&t.userAgentData.platform:void 0,referrer:o})})).json()}async function sendDataToBackend(e){try{return(await fetch("https://coframe.ai/api/v1/session_result/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}catch(e){console.error("Failed to send data:",e)}}function measureEngagement(){const e=new Date-o;e>=t?(a=!0,sendDataToBackend({engagement:!0,session_ids:s,experienced_coframe_ids:c})):setTimeout(measureEngagement,t-e)}function measureConversion(){r=!0,i=!1,sendDataToBackend({conversion:!0,session_ids:s,experienced_coframe_ids:c})}function measureBounce(){i&&sendDataToBackend({bounced:!0,session_ids:s,experienced_coframe_ids:c})}function updateViewedVariants(e){return function wrapped(n){e.filter((({coframe_id:e})=>!c.includes(e))).forEach((({coframe_id:e})=>{document.querySelectorAll(`[coframe-id="${e}"]`).forEach((n=>{(function isElementVisible(e){const n=e.getBoundingClientRect();return n.top>=0&&n.bottom<=window.innerHeight})(n)&&(n.setAttribute("coframe-experienced","true"),c.push(e))}))}))}}const d={init:async function(){const e=window.COFRAME_PAGE_ID;o=new Date;const n=await getVariants(e,o,navigator,document.referrer),a=n.variants;s=n.session_ids,window.addEventListener("beforeunload",measureBounce),document.addEventListener("visibilitychange",measureEngagement),document.addEventListener("conversion",measureConversion),setTimeout(measureEngagement,t),document.addEventListener("coframe:dom-renderer:complete",updateViewedVariants(a)),document.addEventListener("scroll",updateViewedVariants(a));try{a.forEach((({original:e,copy:n,coframe_id:t})=>{replaceHTMLContent(e,n,t)}))}catch{}document.dispatchEvent(new CustomEvent("coframe:dom-renderer:complete",{}))},logCoframeConversion:function(){document.dispatchEvent(new CustomEvent("conversion",{}))}};window.Coframe=d,d.init(),Coframejs=n})();